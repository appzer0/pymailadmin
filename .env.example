# .env.example
# Copy this file as ".env" and modify it to suit your needs.

# A common name to display in pages and emails:
PRETTY_NAME="pymailadmin"

# The base URL to access pymailadmin:
PYMAILDMIN_URL="https://mydopemailadmin.domain.tld"

# Language for the web interface (ISO 639-1 + region, e.g. fr-FR, en-US, es-ES)
# Defaults to en-US if not set
APP_LANGUAGE=en-US

# Unique 64-char secret key. You may use `pwgen -Ans 64 1`:
SECRET_KEY=your-64-char-secret-key-here 

# SMTP settings for mail notifications:
MAIL_SMTP_HOST=smtp.domain.tld
MAIL_SMTP_PORT=465
MAIL_SMTP_USERNAME=smtpuser
MAIL_SMTP_PASSWORD=smtppw
MAIL_FROM_EMAIL=no-reply@domain.tld
MAIL_FROM_NAME=Mail Server Admin

# MySQL connection settings:
DB_HOST=127.0.0.1
DB_NAME=dbname
DB_USER=sqluser
DB_PASSWORD=sqlpassword

# Static dir:
STATIC_DIR=/var/www/pymailadmin/static

# CSS filename:
CSS_MAIN=main.css

# Maximum number of mailboxes per user:
MAX_MAILBOXES_PER_USER=3

# Maximum number of aliases per mailbox:
MAX_ALIASES_PER_MAILBOX=100

## HASH ALGORITHM FOR MAILBOX PASSWORDS
## Supported: argon2id, argon2i, bcrypt, sha512-crypt, sha256-crypt, pbkdf2
## Example:
## DOVECOT_HASH=argon2id          # argon2id, argon2i, bcrypt, sha512-crypt, sha256-crypt, pbkdf2
## DOVECOT_HASH_PREFIX={ARGON2ID} # Optional, will be automatically chosen if left blank

# argon2id, argon2i, bcrypt, sha512-crypt, sha256-crypt or pbkdf2:
DOVECOT_HASH=argon2id           

# Optional, will be automatically chosen if left blank:
DOVECOT_HASH_PREFIX=

# Hashing parameters and cost, only for argon2i and argon2id:
DOVECOT_ARGON2_TIME_COST=3
DOVECOT_ARGON2_MEMORY_COST=65536
DOVECOT_ARGON2_PARALLELISM=2

# Only for BCRYPT:
DOVECOT_BCRYPT_ROUNDS=12       

# Only for PBKDF2:
DOVECOT_PBKDF2_ROUNDS=480000   

# ============================================
# DATABASE SCHEMA CUSTOMIZATION
# ============================================
# Adapt these variables to match your existing Dovecot/Postfix database structure.
# pymailadmin will automatically generate SQL queries based on these settings.

# --------------------------------------------
# 1. DOMAINS TABLE
# --------------------------------------------
# Table name for domains:
DB_TABLE_DOMAINS=domain

# Field names:
DB_FIELD_DOMAIN_ID=id
DB_FIELD_DOMAIN_NAME=domain

# --------------------------------------------
# 2. USERS/MAILBOXES TABLE
# --------------------------------------------
# Table name for mailboxes/users:
DB_TABLE_USERS=users

# Field names:
DB_FIELD_USER_ID=id
DB_FIELD_USER_DOMAIN_ID=domain_id
DB_FIELD_USER_EMAIL=email
DB_FIELD_USER_PASSWORD=crypt

# The Dovecot quota field, specified in bytes or human-readable (with G, M, etc.)
DB_FIELD_USER_QUOTA=quota

# Active account field name (values: 0 or 1)
DB_FIELD_USER_ACTIVE=active

# --------------------------------------------
# 3. ALIASES TABLE
# --------------------------------------------
# Table name for aliases:
DB_TABLE_ALIASES=alias

# Field names:
DB_FIELD_ALIAS_ID=id
DB_FIELD_ALIAS_DOMAIN_ID=domain_id
DB_FIELD_ALIAS_SOURCE=source
DB_FIELD_ALIAS_DESTINATION=destination























## SQL REQUESTS FOR DOVECOT
##
## Adaptable SQL requests to match your database structure.
##
## EXAMPLE: you use "mailboxes" table name to store users, in which you
## use "password_hash" field name for storing hashes, "domain_id" for
## the primary key ID. Then your SQL requests will look like this:
##
## SQL_SELECT_USER_BY_EMAIL="SELECT * FROM mailboxes WHERE email = ?"
## SQL_UPDATE_USER_PASSWORD="UPDATE mailboxes SET password_hash = ? WHERE id = ?"
## SQL_INSERT_USER="INSERT INTO mailboxes (domain_id, email, password_hash, quota) VALUES (?, ?, ?, ?)"
##
## END OF EXAMPLE

# Now adapt the following SQL requests to your database structure:

# 1. DOMAINS TABLE
# -  Replace "domain" here with you domains' table name.
#  - Replace "id", "domain" by your fields name.

SQL_SELECT_DOMAIN_BY_NAME="SELECT * FROM domain WHERE domain = ?"
SQL_SELECT_DOMAIN_BY_ID="SELECT * FROM domain WHERE id = ?"
SQL_SELECT_ALL_DOMAINS="SELECT id, domain FROM domain"

# 2. MAILBOXES USERS TABLE
# - You will need a special field like "enabled" or "active" states in
#   your table structure. This field is mandatory for pymailadmin.
# - Replace "users" here with you users' table name
# - Replace "email" with your mailbox adresse field name.
#   The mailbox expected format is "user@domain.tld"
# - Replace ID fields "id" and "domain_id" here with you IDs fields name
# - Replace "crypt" field with the field name you use for storing
#   password hashes for Dovecot (the "{ARGON2ID}blahblah" hashes)

SQL_INSERT_USER="INSERT INTO users (domain_id, email, crypt, quota, note, active) VALUES (?, ?, ?, ?, ?, ?)"
SQL_SELECT_USER_BY_ID_IN="SELECT * FROM users WHERE id IN ({user_ids})"
SQL_SELECT_USERS_BY_DOMAIN="SELECT * FROM users WHERE domain_id = ?"
SQL_SELECT_USER_BY_ID="SELECT * FROM users WHERE id = ?"
SQL_SELECT_USER_BY_EMAIL="SELECT * FROM users WHERE email = ?"
SQL_UPDATE_USER_PASSWORD="UPDATE users SET crypt = ? WHERE id = ?"
SQL_UPDATE_USER_EMAIL="UPDATE users SET email = ? WHERE id = ?"
SQL_DISABLE_USER="UPDATE users SET active = 0 WHERE email = ?"
SQL_DELETE_USER="DELETE FROM users WHERE id = ?"
SQL_COUNT_ACTIVE_MAILBOXES_BY_OWNER="SELECT COUNT(*) as count FROM pymailadmin_ownerships o INNER JOIN users u ON o.user_id = u.id LEFT JOIN pymailadmin_deletion_pending dp ON u.email = dp.email WHERE o.admin_user_id = %s AND dp.email IS NULL"

# - For the following one, replace "users", "users.email" and 
#   "users.enabled" ONLY with the ones you use. The "email" field is
#   from pymailadmin's rekey_pending table so don't touch it:

SQL_REACTIVATE_USER_AFTER_REKEY_TIMEOUT="UPDATE users INNER JOIN (SELECT email FROM pymailadmin_rekey_pending WHERE created_at < NOW() - INTERVAL %s MINUTE) AS expired ON users.email = expired.email SET users.active = 1"

# 3. ALIASES TABLE
# - Replace "alias" here with you aliases' table name.
# - Replace ID fields "id" and  "domain_id" here with your fields names.
# - Replace "id" and  "domain_id" here with your fields names.
# - Replace "source" with your mailbox field name (usually matching the
#   one from your users' table "user@domain.tld")
# - Replace "destination" with your festination mailbox field name.

SQL_INSERT_ALIAS="INSERT INTO alias (domain_id, source, destination) VALUES (?, ?, ?)"
SQL_SELECT_ALIAS_BY_ID="SELECT * FROM alias WHERE id = ?"
SQL_SELECT_ALIAS_BY_DOMAIN="SELECT * FROM alias WHERE domain_id = ?"
SQL_SELECT_ALIAS_BY_MAILBOX="SELECT * FROM alias WHERE domain_id = ? AND destination = ?"
SQL_SELECT_ALIAS_BY_SOURCE="SELECT * FROM alias WHERE source = ?"
SQL_UPDATE_ALIAS="UPDATE alias SET source = ?, destination = ? WHERE id = ?"
SQL_DELETE_ALIAS="DELETE FROM alias WHERE id = ?"
